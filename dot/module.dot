digraph modules{
	center=true;
	size="800,800";
	PSP;
	Normandy;
	Zeus;
	SigmaApiServer;
	Etcd;
	HippoMaster;
	IPAM;
	SigmaAgent;
	GNS;
	NcApiServer;
	/*    SigmaApiServer->Etcd;
		  HippoMaster->Etcd;
		  SigmaApiServer->IPAM;
		  SigmaApiServer->GNS;
		  SigmaApiServer->NcApiServer;
		  SigmaApiServer->Zeus;
		  edge [color=red];
		  SigmaApiServer->Carbon;
	 */
	PSP -> Normandy [label=" app1 add \n 5 replica"];
	Normandy -> Zeus [label=" app1 add \n 5 replica"];
	Zeus -> SigmaApiServer [label=" [i301]-POST\n /containers/create\n replica=25"];
	HippoMaster -> Etcd [label=" [d100]-watch app requirements"];
	SigmaApiServer -> Etcd [label=" [d100]-app1.replica=25\n app1.spec=new-spec\n [d104]-watch 5 new allocs"];
	HippoMaster -> Etcd [label=" [d104]-set alloc plan to app1\n status=allocated"];
	SigmaApiServer -> IPAM [label=" [i901]-create 5 container ips"];
	IPAM -> SigmaApiServer [label=" 5 ips belong nc net location"];
	SigmaApiServer -> GNS [label=" [i911]-create GNS items"];
	GNS -> Armory [label=" create Armory item\n (avoid ip conflict)"];
	SigmaApiServer -> NcApiServer [label=" [i301]-POST /containers/create?spec"];
	NcApiServer -> Container [label=" Create"];
	Container -> NcApiServer [label=" Done"];
	NcApiServer -> SigmaApiServer [label=" Done"];
	SigmaApiServer -> GNS [label=" [i912]-update ip to Online"];
	GNS -> Armory [label=" update Armory item\n to Online"];
	SigmaApiServer -> Zeus [label=" done"];
	edge [color=red];

	PSP -> Normandy [label=" app1 add \n 5 replica"];
	Normandy -> Zeus [label=" app1 add \n 5 replica"];
	Zeus -> SigmaApiServer [label=" [i301]-POST\n /containers/create\n replica=25"];
	HippoMaster -> Etcd [label=" [d100]-watch app requirements"];
	SigmaApiServer -> Etcd [label=" [d100]-app1.replica=25\n app1.spec=new-spec\n [d104]-watch 5 new allocs"];
	HippoMaster -> Etcd [label=" [d104]-set alloc plan to app1\n status=allocated"];
	SigmaApiServer -> IPAM [label=" [i901]-create 5 container ips"];
	IPAM -> SigmaApiServer [label=" 5 ips belong nc net location"];
	SigmaApiServer -> GNS [label=" [i911]-create GNS items"];
	GNS -> Armory [label=" create Armory item\n (avoid ip conflict)"];
	SigmaApiServer -> NcApiServer [label=" [i301]-POST /containers/create?spec"];
	NcApiServer -> Container [label=" Create"];
	Container -> NcApiServer [label=" Done"];
	NcApiServer -> SigmaApiServer [label=" Done"];
	SigmaApiServer -> GNS [label=" [i912]-update ip to Online"];
	GNS -> Armory [label=" update Armory item\n to Online"];
	SigmaApiServer -> Zeus [label=" done"];

	edge [color=blue];

	PSP -> Normandy [label=" app1 delete \n 5 instanceid"];
	HippoMaster -> Etcd [label=" [d109]watch release slot\n [d105]watch slot states"];
	Normandy -> Normandy [label=" offline from vip"];
	Normandy -> Zeus [label=" destroy instance-i"];
	Zeus -> SigmaApiServer [label=" [i301]-DELETE\n /containers/instance-i"];
	SigmaApiServer -> Etcd [label=" [d100]-app.replica -= 1\n [d109]-write release slot\n /releases/$site/$slotId"];
	HippoMaster -> Etcd [label=" [d104]-Set slot status to reclaiming"];
	SigmaApiServer -> NcApiServer [label=" [i302]-DELETE \n /containers/instance-i?force=1"];
	NcApiServer -> SigmaApiServer [label=" Done"];
	SigmaAgent -> NcApiServer [label=" watch slots states"];
	SigmaAgent -> Etcd [label=" [d105]-remove slot from slot states"];
	SigmaApiServer -> IPAM [label=" [i902]-release container ips"];
#IPAM -> SigmaApiServer [label=" released"];
	SigmaApiServer -> GNS [label=" [i913]-delete GNS items"];
	SigmaApiServer -> Zeus [label=" Done"];
	HippoMaster -> Etcd [label=" [d103]-remove slot from allocinfos\n /applications/.../$deployunit/allocinfos\n [d104]-remove slot from alloc plan\n /allocinfos/$site/$sn/allocplans/$slotId"];
	Zeus -> Normandy [label=" Done"];
	//SigmaApiServer -> Zeus [label=" done"];
	//Zeus -> Normandy [label=" done"];
	Normandy -> PSP [label=" done"];
}
